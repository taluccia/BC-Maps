---
title: "BC-Maps"
author: "Anna Talucci"
date: "11/12/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Overview



# Packages
```{r message=FALSE, warning=FALSE}
library(leaflet)
library(dplyr)
library(tidyr)
library(ggplot2)
library(DT)
library(sf)
library(ggmap) # devtools::install_github("dkahle/ggmap")
library(ggrepel)
library(RStoolbox)
library(raster)
library(rgdal)
library(rasterVis)
library(RColorBrewer)
library(cowplot)
library(ggspatial)
library(maps)
library(maptools)
library(rgeos)
library(sp)
library(mapproj)
```

# Projection
[BC Albers Equal Area projection](https://georepository.com/crs_3005/NAD83-BC-Albers.html)

https://epsg.io/3005 or https://spatialreference.org/ref/epsg/3005/

```{r}
ea_bc = "+proj=aea +lat_1=50 +lat_2=58.5 +lat_0=45 +lon_0=-126 +x_0=1000000 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs"
```

# Data

## Raster
```{r}
bc_stack <- stack("../data/raster/BC-Landsat-Image.tif")
```

```{r}
extent(bc_stack)
```

## Shapefiles
```{r}
tw_perm = st_read("../data/Fire-Perimeters-Original/tw_R10252_2013.shp", "tw_R10252_2013") 
```

```{r}
ch_perm = st_read("../data/Fire-Perimeters-Original/ch_R10070_2014.shp", "ch_R10070_2014") 
```

```{r}
en_perm = st_read("../data/Fire-Perimeters-Original/en_R10171_2012.shp", "en_R10171_2012") 
```

```{r}
bc = st_read("../shapefiles/province_bc_alber.shp")
```

```{r}
lakes = st_read("../shapefiles/Lakes_select_fire.shp")
```

```{r}
parks = st_read("../shapefiles/tweed-entiako_singlepoly.shp")
```

```{r}
city = st_read("../shapefiles/BC_Vancouver_PrinceGeorge.shp")
```
# Reproject in Equal area

```{r}
img_ea <- projectRaster(bc_stack, crs = ea_bc)

```

```{r}
extent(img_ea)
```
```{r}
tw_ea = st_transform(tw_perm, crs=ea_bc)
ch_ea = st_transform(ch_perm, crs=ea_bc)
en_ea = st_transform(en_perm, crs=ea_bc)
```

```{r}
bc_ea = st_transform(bc, crs=ea_bc)
lakes_ea = st_transform(lakes, crs=ea_bc)
parks_ea = st_transform(parks, crs=ea_bc)
city_ea = st_transform(city, crs=ea_bc)
```

# Unused code (DELETE)
```{r eval=FALSE, include=FALSE}
fire1 <- st_read(
  "../shapefiles/ch_R10070_2014.shp")
```

```{r eval=FALSE, include=FALSE}
fire2 <- st_read(
  "../shapefiles/en_R10171_2012.shp")
```

```{r eval=FALSE, include=FALSE}
fire3 <- st_read(
  "../shapefiles/tw_R10252_2013.shp")
```

```{r eval=FALSE, include=FALSE}
all_fires= st_read("../shapefiles/perimeter_merge.shp")
```


# Bounding Box
```{r}

(insetrect <- data.frame(xmin = 985362, xmax = 1069051,
    ymin = 894097.7, ymax = 939814.2))
```




```{r}
labs <- tibble(
  long = c(-123.1207, -122.7497),
  lat = c(49.2827, 53.9171),
  names = c("Vancouver", "Prince George")) 
```

```{r}
linecolors <- c("#714C02", "#01587A", "#024E37")
fillcolors <- c("#9D6C06", "#077DAA", "#026D4E")
```




# Manuscript Figure

## BC Map for inset
```{r}
map_bc2 = ggplot() + 
  geom_sf(data = bc, fill = "#E8E8E8", color = "black") +
  geom_rect(data = insetrect, aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax), alpha = 0, colour = "#000080", size = 1.5, linetype = 1) +
  xlab("")+ylab("")+
  coord_sf() +
   theme_void() +
  # add a bounding box so that will border the inset
  theme(panel.background = element_rect(colour = "black", fill = "white", size = 0.5))


map_bc2
```


## Fire perimeter Map

```{r}
map_legend = ggplot() +
  geom_sf(data = bc, aes(fill = "BC", color = "BC")) +
    geom_sf(data = parks, aes(fill = "Parks", color = "Parks"), show.legend = TRUE) +
    geom_sf(data = lakes, aes(fill = "Lakes", color = "Lakes"), show.legend = TRUE, key_glyph = draw_key_rect) +
  geom_sf(data = fire1, fill = NA, aes(color = "Fire1"), size = 1, show.legend = TRUE, key_glyph = draw_key_rect) +
  geom_sf(data = fire2, fill = NA, aes(color = "Fire2"), size = 1, show.legend = TRUE) +
  geom_sf(data = fire3, fill = NA, aes(color = "Fire3"), size = 1, show.legend = TRUE) +
  scale_color_manual(values = c("BC" = "#E8E8E8", "Parks" = "#C3ECB2", "Lakes" = "#AADAFF", "Fire1" = "#b82b2b", "Fire2" = "#b06f0c", "Fire3" =  "#dd7116"), 
                       labels = c("British Columbia", "Chelaslie fire", "Entiako fire", "Tweedsmuir fire", "Lakes", "Provincial parks"),
                       name = "Legend") +
  scale_fill_manual(values = c("BC" = "#E8E8E8", "Parks" = "#C3ECB2", "Lakes" = "#AADAFF", "Fire1" = NA, "Fire2" = NA, "Fire3" =  NA),
                    guide=FALSE) +
  coord_sf(crs = "+proj=aea +lat_1=50 +lat_2=58.5 +lat_0=45 +lon_0=-126 +x_0=1000000 +y_0=0 +datum=NAD83 +units=m +no_defs", xlim = c(983000, 1071000), ylim = c(892000, 941000), expand = FALSE)  + 
      annotation_scale(location = "br", width_hint = 0.25, text_size = 12, text_face = NULL, text_family = "serif", text_col = "black") +
    annotation_north_arrow(location = "tl", which_north = "true", 
        pad_x = unit(0.1, "in"), pad_y = unit(0.1, "in"),
        style = north_arrow_nautical(line_width = 1, line_col = "black", fill = c("black", "white"), text_size = 10, text_face = NULL, text_family = "serif", text_col = "black", text_angle = 0)) +
  theme(axis.text.x = element_text(face = "plain", color = "black", size = 12),
        axis.text.y = element_text(face = "plain", color = "black", size = 12),
        legend.position= c(0.88, 0.35),
        legend.key = element_rect(fill = "white")) 


map_legend
```

Colors:
-- gray green #75816B
-- Silver #C0C0C0
-- light slate #778899
-- Tomato #ff6347
-- Gray #7E7E7E
-- dark slate #3F4354

```{r}
map_legend2 = ggplot() +
  geom_sf(data = bc, aes(fill = "BC", color = "BC")) +
    geom_sf(data = parks, aes(fill = "Parks", color = "Parks"), show.legend = TRUE) +
    geom_sf(data = lakes, aes(fill = "Lakes", color = "Lakes"), show.legend = TRUE, key_glyph = draw_key_rect) +
  geom_sf(data = fire1, fill = NA, aes(color = "Fire1"), size = 1, show.legend = TRUE, key_glyph = draw_key_rect) +
  geom_sf(data = fire2, fill = NA, aes(color = "Fire2"), size = 1, show.legend = TRUE) +
  geom_sf(data = fire3, fill = NA, aes(color = "Fire3"), size = 1, show.legend = TRUE) +
  scale_color_manual(values = c("BC" = "#7E7E7E", "Parks" = "#75816B", "Lakes" = "#AADAFF", "Fire1" = "#fee08b", "Fire2" = "#ff6347", "Fire3" ="#fdae61" ), 
                       labels = c("British Columbia", "Chelaslie fire", "Entiako fire", "Tweedsmuir fire", "Lakes", "Provincial parks"),
                       name = "") +
  scale_fill_manual(values = c("BC" = "#7E7E7E", "Parks" = "#75816B", "Lakes" = "#AADAFF", "Fire1" = NA, "Fire2" = NA, "Fire3" =  NA),
                    guide=FALSE) +
  coord_sf(crs = "+proj=aea +lat_1=50 +lat_2=58.5 +lat_0=45 +lon_0=-126 +x_0=1000000 +y_0=0 +datum=NAD83 +units=m +no_defs", xlim = c(983000, 1071000), ylim = c(892000, 941000), expand = FALSE)  + 
      annotation_scale(location = "br", width_hint = 0.25, text_size = 12, text_face = NULL, text_family = "serif", text_col = "black") +
    annotation_north_arrow(location = "br", which_north = "true", 
        pad_x = unit(0.4, "in"), pad_y = unit(0.5, "in"),
        style = north_arrow_nautical(line_width = 1, line_col = "black", fill = c("black", "white"), text_size = 10, text_face = NULL, text_family = "serif", text_col = "black", text_angle = 0)) +
  theme(axis.text.x = element_text(face = "plain", color = "black", size = 10),
        axis.text.y = element_text(face = "plain", color = "black", size = 10),
        legend.position= "bottom",
        legend.key = element_rect(fill = "white")) 


map_legend2
```

### Combine with inset map
```{r fig.height=4, fig.width=6}

fig_manuscript2 = ggdraw() +
   draw_plot(map_legend2) +
  draw_plot(map_bc2, x = 0.12, y = 0.32, width = .25, height = .25) 
 

fig_manuscript2


```

```{r}
ggsave("../figures/2021-01-19_bc_map_manuscript.png", plot = fig_manuscript2, width = 6, height = 4, dpi = 600)
```




# Map  with satelliite image
class      : Extent 
xmin       : 976470 
xmax       : 1081530 
ymin       : 880380 
ymax       : 951870 

```{r fig.height=5, fig.width=6}
sat_map =  ggplot() + 
  ggRGB(img_ea, r=1, g=2, b=3, ggLayer = TRUE, coord_equal = TRUE) +

  geom_sf(data = ch_ea, fill = NA, aes(color = "Fire1"), size = 1, show.legend = TRUE, key_glyph = draw_key_rect) +
  geom_sf(data = en_ea, fill = NA, aes(color = "Fire2"), size = 1, show.legend = TRUE) +
  geom_sf(data = tw_ea, fill = NA, aes(color = "Fire3"), size = 1, show.legend = TRUE) +
  
  scale_color_manual(values = c("Fire1" = "#fee08b", "Fire2" = "#ff6347", "Fire3" ="#fdae61" ), labels = c( "Chelaslie fire", "Entiako fire", "Tweedsmuir fire"), name = "") +
  scale_fill_manual(values = c("BC" = "#7E7E7E", "Parks" = "#75816B", "Lakes" = "#AADAFF", "Fire1" = NA, "Fire2" = NA, "Fire3" =  NA),
                    guide=FALSE) +
  
      annotation_north_arrow(location = "br", which_north = "true", pad_x = unit(0.0, "cm"), pad_y = unit(0.7, "cm"), style = north_arrow_minimal(line_width = 1, line_col = "white", fill = "white", text_size = 0, text_face = NULL, text_family = "sans", text_col = "white")) +
  
  
  annotation_scale(location = "br", width_hint = 0.25, text_size = 12, text_face = "bold", text_family = "sans", text_col = "white") +
  
   theme_classic() +
  
  theme(plot.margin = unit(c(t = 0.2, r = 0.2, b = 0.2, l = 0.2), "cm")) +
    theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.background = element_blank(), 
        axis.line = element_line(colour = "white")) +
  theme(legend.position = "bottom")


sat_map

```

## Combine with inset map
```{r fig.height=4, fig.width=6}

fig_man3 = ggdraw() +
   draw_plot(sat_map) +
  draw_plot(map_bc2, x = 0.12, y = 0.32, width = .2, height = .2) 
 

fig_man3


```

```{r}
ggsave("../figures/2021-05-13_bc_map_manuscript.png", plot = fig_man3, width = 6, height = 4, dpi = 600)
```

# Poster
```{r}
map_fires = ggplot() +
  geom_sf(data = bc, fill = "#E8E8E8", color = "#E8E8E8") +
    geom_sf(data = parks, fill = "#C3ECB2", color = "#C3ECB2") +
    geom_sf(data = lakes, fill = "#AADAFF", color = "#AADAFF") +
  geom_sf(data = fire1, fill = NA, color = "#b82b2b", size = 1) +
  geom_sf(data = fire2, fill = NA, color = "#b06f0c", size = 1) +
  geom_sf(data = fire3, fill = NA, color = "#dd7116", size = 1) +
  coord_sf(crs = "+proj=aea +lat_1=50 +lat_2=58.5 +lat_0=45 +lon_0=-126 +x_0=1000000 +y_0=0 +datum=NAD83 +units=m +no_defs", xlim = c(983000, 1071000), ylim = c(892000, 941000), expand = FALSE)  + 
      annotation_scale(location = "br", width_hint = 0.25, text_size = 12, text_face = NULL, text_family = "serif", text_col = "black") +
    annotation_north_arrow(location = "br", which_north = "true", 
        pad_x = unit(0.75, "in"), pad_y = unit(0.5, "in"),
        style = north_arrow_nautical(line_width = 1, line_col = "black", fill = c("black", "white"), text_size = 10, text_face = NULL, text_family = "serif", text_col = "black", text_angle = 0)) +
  theme(axis.text.x = element_text(face = "plain", color = "black", size = 12),
        axis.text.y = element_text(face = "plain", color = "black", size = 12)) 


map_fires
```
